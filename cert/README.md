# Cert ä¼ä¸šçº§è½¯ä»¶æˆæƒç®¡ç†è§£å†³æ–¹æ¡ˆ

`cert` åŒ…æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ä¼ä¸šçº§è½¯ä»¶æˆæƒç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œæä¾›è¯ä¹¦ç­¾å‘ã€éªŒè¯ã€åŠé”€ä»¥åŠ**å¯é€‰çš„**å®‰å…¨é˜²æŠ¤åŠŸèƒ½ã€‚ä¸“ä¸ºéœ€è¦è½¯ä»¶è®¸å¯æ§åˆ¶çš„åº”ç”¨ç¨‹åºè®¾è®¡ï¼Œ**é»˜è®¤å¼€å‘å‹å¥½ï¼ŒæŒ‰éœ€å¯ç”¨å®‰å…¨ä¿æŠ¤**ã€‚

## ğŸš€ ä¸»è¦ç‰¹æ€§

### ğŸ“œ è¯ä¹¦ç®¡ç†
- **CA è¯ä¹¦ç”Ÿæˆ**ï¼šæ”¯æŒè‡ªå®šä¹‰ CA è¯ä¹¦å’Œç§é’¥ç®¡ç†
- **å®¢æˆ·ç«¯è¯ä¹¦ç­¾å‘**ï¼šåŸºäºæœºå™¨ç çš„è¯ä¹¦ç­¾å‘ç³»ç»Ÿ
- **è¯ä¹¦éªŒè¯**ï¼šå®Œæ•´çš„è¯ä¹¦é“¾éªŒè¯å’Œæœ‰æ•ˆæ€§æ£€æŸ¥
- **è¯ä¹¦åŠé”€**ï¼šåŠ¨æ€åŠé”€åˆ—è¡¨ç®¡ç†å’Œå®æ—¶æ›´æ–°
- **æ‰¹é‡å¤„ç†**ï¼šæ”¯æŒå¤§è§„æ¨¡è¯ä¹¦æ‰¹é‡ç­¾å‘å’ŒéªŒè¯

### ğŸ›¡ï¸ å®‰å…¨é˜²æŠ¤ï¼ˆå¯é€‰ï¼‰
- **åˆ†çº§ä¿æŠ¤**ï¼š4ä¸ªå®‰å…¨çº§åˆ«ï¼Œä»ç¦ç”¨åˆ°å…³é”®é˜²æŠ¤
- **åè°ƒè¯•ä¿æŠ¤**ï¼šå¤šå±‚æ¬¡è°ƒè¯•å™¨æ£€æµ‹å’Œé˜²æŠ¤æœºåˆ¶
- **ç¯å¢ƒæ£€æµ‹**ï¼šè™šæ‹Ÿæœºå’Œæ²™ç®±ç¯å¢ƒè¯†åˆ«
- **è¿›ç¨‹ä¿æŠ¤**ï¼šDLLæ³¨å…¥å’Œä»£ç æ³¨å…¥æ£€æµ‹
- **æ—¶é—´ç¯¡æ”¹æ£€æµ‹**ï¼šç³»ç»Ÿæ—¶é—´éªŒè¯å’Œæ—¶é’Ÿåå·®æ£€æŸ¥
- **å®Œæ•´æ€§éªŒè¯**ï¼šç¨‹åºå®Œæ•´æ€§æ ¡éªŒå’Œå†…å­˜ä¿æŠ¤
- **ç¡¬ä»¶ç»‘å®š**ï¼šåŸºäºæœºå™¨ç çš„ç¡¬ä»¶ç»‘å®šéªŒè¯

### ğŸ“Š æˆæƒç®¡ç†
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šå¼ºåˆ¶ç‰ˆæœ¬æ›´æ–°å’Œå…¼å®¹æ€§ç®¡ç†
- **æœ‰æ•ˆæœŸç®¡ç†**ï¼šçµæ´»çš„è¯ä¹¦ç”Ÿå‘½å‘¨æœŸæ§åˆ¶
- **æˆæƒç®¡ç†**ï¼šå®Œæ•´çš„å®¢æˆ·ä¿¡æ¯å’Œè”ç³»æ–¹å¼ç®¡ç†
- **æ™ºèƒ½ç›‘æ§**ï¼šè‡ªåŠ¨ç›‘æ§è¯ä¹¦çŠ¶æ€ï¼ŒåŠæ—¶é€šçŸ¥åˆ°æœŸå’Œå¼‚å¸¸äº‹ä»¶
- **ç¼“å­˜ä¼˜åŒ–**ï¼šæ™ºèƒ½ç¼“å­˜æœºåˆ¶æå‡éªŒè¯æ€§èƒ½
- **é…ç½®ç®¡ç†**ï¼šçµæ´»çš„é…ç½®ç³»ç»Ÿæ”¯æŒå¤šç¯å¢ƒéƒ¨ç½²

## ğŸ“¦ å®‰è£…

```bash
go get github.com/darkit/machineid/cert
```

## âš¡ å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»ºæˆæƒç®¡ç†å™¨

```go
import "github.com/darkit/machineid/cert"

// å¼€å‘ç¯å¢ƒï¼ˆå®Œå…¨ç¦ç”¨å®‰å…¨æ£€æŸ¥ï¼Œæ¨èï¼‰
auth, err := cert.ForDevelopment().Build()
if err != nil {
    log.Fatal("åˆ›å»ºæˆæƒç®¡ç†å™¨å¤±è´¥:", err)
}

// ç”Ÿäº§ç¯å¢ƒï¼ˆåŸºç¡€å®‰å…¨æ£€æŸ¥ï¼‰
prodAuth, err := cert.ForProduction().Build()

// é»˜è®¤é…ç½®ï¼ˆç¦ç”¨å®‰å…¨æ£€æŸ¥ï¼‰
defaultAuth, err := cert.NewAuthorizer().Build()

// è‡ªå®šä¹‰å®‰å…¨çº§åˆ«
customAuth, err := cert.NewAuthorizer().
    WithVersion("2.0.0").
    WithSecurityLevel(2).                 // é«˜çº§å®‰å…¨ä¿æŠ¤
    WithMaxClockSkew(1 * time.Minute).
    Build()
```

### 2. ç”Ÿæˆ CA è¯ä¹¦

```go
caInfo := cert.CAInfo{
    CommonName:   "ZStudio Software CA",
    Organization: "å­è¯´è½¯ä»¶å·¥ä½œå®¤",
    Country:      "CN",
    Province:     "Guangdong", 
    Locality:     "Guangzhou",
    ValidDays:    3650, // 10å¹´æœ‰æ•ˆæœŸ
    KeySize:      4096,
}

// ç”Ÿæˆæ–°çš„CAè¯ä¹¦
err := auth.GenerateCA(caInfo)
if err != nil {
    log.Fatal("ç”ŸæˆCAè¯ä¹¦å¤±è´¥:", err)
}

// ä¿å­˜CAè¯ä¹¦åˆ°æŒ‡å®šç›®å½•
err = auth.SaveCA("./certificates")
```

### 3. ç­¾å‘å®¢æˆ·ç«¯è¯ä¹¦

```go
// æ„å»ºè¯ä¹¦è¯·æ±‚
req := &cert.ClientCertRequest{
    Identity: cert.Identity{
        MachineID:  "DESKTOP-ABC123-HDD-12345678",
        ExpiryDate: time.Now().AddDate(1, 0, 0), // 1å¹´æœ‰æ•ˆæœŸ
    },
    Company: cert.Company{
        Name:       "å®¢æˆ·å…¬å¸",
        Department: "æŠ€æœ¯éƒ¨",
        Address: &cert.Address{
            Country:  "CN",
            Province: "å¹¿ä¸œçœ",
            City:     "æ·±åœ³å¸‚", 
            Street:   "ç§‘æŠ€å›­å—è·¯",
        },
    },
    Contact: &cert.Contact{
        Person: "å¼ ä¸‰",
        Phone:  "13800138000", 
        Email:  "zhangsan@example.com",
    },
    Technical: cert.Technical{
        Version:            "2.0.0",
        ValidityPeriodDays: 365,
    },
}

// ç­¾å‘è¯ä¹¦
certificate, err := auth.IssueClientCert(req)
if err != nil {
    log.Fatal("ç­¾å‘è¯ä¹¦å¤±è´¥:", err)
}

// ä¿å­˜å®¢æˆ·ç«¯è¯ä¹¦
err = auth.SaveClientCert(certificate, "./client-certificates")
```

### 4. è¯ä¹¦éªŒè¯ï¼ˆå¯é€‰å®‰å…¨æ£€æŸ¥ï¼‰

```go
// è¯ä¹¦éªŒè¯ï¼ˆæ ¹æ®å®‰å…¨çº§åˆ«è‡ªåŠ¨æ‰§è¡Œæ£€æŸ¥ï¼‰
err := auth.ValidateCert(certificate.CertPEM, machineID)
if err != nil {
    switch {
    case cert.IsSecurityError(err):
        log.Printf("å®‰å…¨æ£€æŸ¥å¤±è´¥: %v", err)
        // å¤„ç†å®‰å…¨é—®é¢˜ï¼šè°ƒè¯•å™¨ã€è™šæ‹Ÿæœºã€æ²™ç®±ç­‰
        // åªæœ‰åœ¨å¯ç”¨å®‰å…¨æ£€æŸ¥æ—¶æ‰ä¼šå‡ºç°
    case cert.IsValidationError(err):
        log.Printf("è¯ä¹¦éªŒè¯å¤±è´¥: %v", err)
        // å¤„ç†è¯ä¹¦é—®é¢˜ï¼šè¿‡æœŸã€åŠé”€ã€æœºå™¨ç ä¸åŒ¹é…ç­‰
    default:
        log.Printf("å…¶ä»–é”™è¯¯: %v", err)
    }
    return
}

log.Println("è¯ä¹¦éªŒè¯æˆåŠŸ")

// æ‰‹åŠ¨æ‰§è¡Œå®‰å…¨æ£€æŸ¥
if err := auth.PerformSecurityCheck(); err != nil {
    log.Printf("æ‰‹åŠ¨å®‰å…¨æ£€æŸ¥å¤±è´¥: %v", err)
}
```

### 5. å®¢æˆ·ä¿¡æ¯æå–

```go
// ä»ç°æœ‰è¯ä¹¦ä¸­æå–å®Œæ•´çš„å®¢æˆ·ä¿¡æ¯
clientInfo, err := auth.ExtractClientInfo(certificate.CertPEM)
if err != nil {
    log.Fatal("æå–å®¢æˆ·ä¿¡æ¯å¤±è´¥:", err)
}

// æ˜¾ç¤ºæå–çš„ä¿¡æ¯
fmt.Printf("=== å®¢æˆ·æˆæƒä¿¡æ¯ ===\n")
fmt.Printf("æœºå™¨ID: %s\n", clientInfo.MachineID)
fmt.Printf("å…¬å¸åç§°: %s\n", clientInfo.CompanyName)
fmt.Printf("éƒ¨é—¨: %s\n", clientInfo.Department)
fmt.Printf("è”ç³»äºº: %s\n", clientInfo.ContactPerson)
fmt.Printf("è”ç³»ç”µè¯: %s\n", clientInfo.ContactPhone)
fmt.Printf("è”ç³»é‚®ç®±: %s\n", clientInfo.ContactEmail)
fmt.Printf("ç¨‹åºç‰ˆæœ¬: %s\n", clientInfo.Version)
fmt.Printf("è¯ä¹¦æœ‰æ•ˆæœŸ: %då¤©\n", clientInfo.ValidityPeriodDays)
fmt.Printf("åˆ°æœŸæ—¶é—´: %s\n", clientInfo.ExpiryDate.Format("2006-01-02 15:04:05"))

// åº”ç”¨åœºæ™¯ç¤ºä¾‹
// 1. å®¢æˆ·ç®¡ç† - å¿«é€Ÿè·å–æˆæƒå®¢æˆ·è”ç³»ä¿¡æ¯
// 2. æŠ€æœ¯æ”¯æŒ - äº†è§£å®¢æˆ·ä½¿ç”¨çš„è½¯ä»¶ç‰ˆæœ¬
// 3. è®¸å¯å®¡è®¡ - ç”Ÿæˆæˆæƒä½¿ç”¨æŠ¥å‘Š
// 4. åˆè§„æ£€æŸ¥ - éªŒè¯æˆæƒåˆ†å‘è®°å½•
```

### 6. æˆæƒç›‘æ§å›è°ƒ

ç³»ç»Ÿæä¾›äº†æ™ºèƒ½çš„æˆæƒç›‘æ§æœºåˆ¶ï¼Œè‡ªåŠ¨å®šæœŸæ£€æŸ¥è¯ä¹¦çŠ¶æ€ï¼Œå¹¶é€šè¿‡å›è°ƒé€šçŸ¥ä¸Šå±‚åº”ç”¨ï¼š

```go
// å®šä¹‰ç›‘æ§å›è°ƒå‡½æ•°
watchCallback := func(event cert.WatchEvent, clientInfo *cert.ClientInfo, err error) {
    switch event {
    case cert.WatchEventExpiring:
        log.Printf("è­¦å‘Š: è¯ä¹¦å³å°†åˆ°æœŸ - %s (%s)", 
            clientInfo.CompanyName, clientInfo.ContactPerson)
        // å‘é€é‚®ä»¶é€šçŸ¥ã€è§¦å‘ç»­æœŸæµç¨‹ç­‰
        sendRenewalNotification(clientInfo)
        
    case cert.WatchEventExpired:
        log.Printf("ç´§æ€¥: è¯ä¹¦å·²è¿‡æœŸ - %s", clientInfo.CompanyName)
        // åœæ­¢æœåŠ¡ã€æ˜¾ç¤ºè¿‡æœŸæç¤ºç­‰
        handleExpiredLicense(clientInfo)
        
    case cert.WatchEventInvalid:
        log.Printf("é”™è¯¯: è¯ä¹¦æ— æ•ˆ - %v", err)
        // é‡æ–°éªŒè¯ã€è”ç³»æ”¯æŒç­‰
        handleInvalidCertificate(err)
        
    case cert.WatchEventRevoked:
        log.Printf("ä¸¥é‡: è¯ä¹¦å·²è¢«åŠé”€ - %s", clientInfo.CompanyName)
        // ç«‹å³åœæ­¢æœåŠ¡ã€å®‰å…¨å®¡è®¡ç­‰
        handleRevokedCertificate(clientInfo)
    }
}

// å¯åŠ¨ç›‘æ§ - ä½¿ç”¨é»˜è®¤é…ç½®ï¼ˆ1å°æ—¶æ£€æŸ¥é—´éš”ï¼Œ7å¤©é¢„è­¦æœŸï¼‰
watcher, err := auth.Watch(certPEM, machineID, watchCallback)

// è‡ªå®šä¹‰ç›‘æ§é—´éš”å’Œé¢„è­¦æœŸ
watcher, err := auth.Watch(certPEM, machineID, watchCallback, 
    30*time.Minute,  // 30åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
    3*24*time.Hour)  // 3å¤©åˆ°æœŸé¢„è­¦

// é«˜çº§é…ç½®ç›‘æ§
watcher := cert.NewCertWatcher(auth, certPEM, machineID, watchCallback).
    WithCheckInterval(10 * time.Minute).     // æ£€æŸ¥é—´éš”
    WithExpiryWarning(24 * time.Hour).       // é¢„è­¦æœŸ
    WithConfig(&cert.WatchConfig{
        EnableRevocationCheck: true,         // å¯ç”¨åŠé”€æ£€æŸ¥
        MaxRetries:           5,             // æœ€å¤§é‡è¯•æ¬¡æ•°
        RetryInterval:        2 * time.Minute, // é‡è¯•é—´éš”
    })

if err := watcher.Start(); err != nil {
    log.Fatal("å¯åŠ¨ç›‘æ§å¤±è´¥:", err)
}

// è·å–ç›‘æ§ç»Ÿè®¡
stats := watcher.GetStats()
fmt.Printf("æ£€æŸ¥æ¬¡æ•°: %v, è¿è¡ŒçŠ¶æ€: %v\n", 
    stats["check_count"], stats["is_running"])

// åœæ­¢ç›‘æ§
watcher.Stop()
```

#### ç›‘æ§ç®¡ç†å™¨ - ç®¡ç†å¤šä¸ªè¯ä¹¦

```go
// åˆ›å»ºç›‘æ§ç®¡ç†å™¨
manager := cert.NewWatcherManager()

// æ·»åŠ å¤šä¸ªè¯ä¹¦ç›‘æ§
watcher1, _ := auth.Watch(cert1PEM, machineID1, callback, time.Hour)
watcher2, _ := auth.Watch(cert2PEM, machineID2, callback, 30*time.Minute)

manager.AddWatcher("license1", watcher1)
manager.AddWatcher("license2", watcher2)

// è·å–æ‰€æœ‰ç›‘æ§ç»Ÿè®¡
allStats := manager.GetAllStats()
for id, stats := range allStats {
    fmt.Printf("%s: æ£€æŸ¥%væ¬¡, è¿è¡Œä¸­=%v\n", 
        id, stats["check_count"], stats["is_running"])
}

// åœæ­¢æ‰€æœ‰ç›‘æ§
manager.StopAll()
```

#### ç›‘æ§äº‹ä»¶ç±»å‹

| äº‹ä»¶ | è§¦å‘æ¡ä»¶ | å»ºè®®å¤„ç† |
|------|----------|----------|
| **WatchEventExpiring** | è·ç¦»åˆ°æœŸæ—¶é—´å°äºé¢„è­¦æœŸ | å‘é€ç»­æœŸæé†’ï¼Œå‡†å¤‡æ–°è¯ä¹¦ |
| **WatchEventExpired** | è¯ä¹¦å·²è¿‡æœŸ | åœæ­¢æœåŠ¡æˆ–æ˜¾ç¤ºè¿‡æœŸæç¤º |
| **WatchEventInvalid** | è¯ä¹¦æ ¼å¼é”™è¯¯æˆ–éªŒè¯å¤±è´¥ | æ£€æŸ¥è¯ä¹¦æ–‡ä»¶ï¼Œè”ç³»æŠ€æœ¯æ”¯æŒ |
| **WatchEventRevoked** | è¯ä¹¦è¢«åŠ å…¥åŠé”€åˆ—è¡¨ | ç«‹å³åœæ­¢æœåŠ¡ï¼Œè¿›è¡Œå®‰å…¨å®¡è®¡ |

#### é»˜è®¤ç›‘æ§é…ç½®

```go
// ç³»ç»Ÿé»˜è®¤é…ç½®
config := cert.DefaultWatchConfig()
// CheckInterval: 1å°æ—¶
// ExpiryWarningPeriod: 7å¤©  
// EnableExpiryWarning: true
// EnableRevocationCheck: true
// MaxRetries: 3æ¬¡
// RetryInterval: 5åˆ†é’Ÿ
```

### 7. è¯ä¹¦åŠé”€ç®¡ç†

```go
// åˆ›å»ºåŠé”€ç®¡ç†å™¨
revokeManager, err := cert.NewRevokeManager("1.0.0")

// åŠé”€ç‰¹å®šè¯ä¹¦
err = revokeManager.RevokeCertificate("è¯ä¹¦åºåˆ—å·", "security_breach")

// æ£€æŸ¥è¯ä¹¦æ˜¯å¦è¢«åŠé”€
isRevoked, reason := revokeManager.IsRevoked("è¯ä¹¦åºåˆ—å·")

// ä½¿ç”¨åŠ¨æ€åŠé”€åˆ—è¡¨
auth, err := cert.NewAuthorizer().
    WithRevokeListUpdater(func() ([]byte, error) {
        // ä»è¿œç¨‹APIè·å–æœ€æ–°åŠé”€åˆ—è¡¨
        resp, err := http.Get("https://api.example.com/revoke-list")
        if err != nil {
            return nil, err
        }
        defer resp.Body.Close()
        return io.ReadAll(resp.Body)
    }).
    Build()
```

## ğŸ›¡ï¸ å®‰å…¨çº§åˆ«ç³»ç»Ÿ

### å®‰å…¨çº§åˆ«æ¦‚è§ˆ

ç³»ç»Ÿæä¾›4ä¸ªå¯é€‰çš„å®‰å…¨çº§åˆ«ï¼Œ**é»˜è®¤å®Œå…¨ç¦ç”¨**ä»¥ç¡®ä¿å¼€å‘å‹å¥½ï¼š

| çº§åˆ« | åç§° | æ£€æµ‹é¡¹ | æ€§èƒ½å½±å“ | é€‚ç”¨åœºæ™¯ |
|------|------|--------|----------|----------|
| **0** | **ç¦ç”¨** | æ— æ£€æµ‹ | æ—  | **å¼€å‘ã€è°ƒè¯•ï¼ˆé»˜è®¤ï¼‰** |
| **1** | **åŸºç¡€** | ç®€å•è°ƒè¯•å™¨æ£€æµ‹ | æå° | **ç”Ÿäº§ç¯å¢ƒ** |
| **2** | **é«˜çº§** | å®Œæ•´åé€†å‘ä¿æŠ¤ | å° | **é«˜ä»·å€¼è½¯ä»¶** |
| **3** | **å…³é”®** | æœ€ä¸¥æ ¼æ£€æŸ¥+è¿›ç¨‹ä¿æŠ¤ | ä¸­ç­‰ | **å…³é”®ç³»ç»Ÿ** |

### é…ç½®æ–¹å¼

```go
// æ–¹å¼1: ä½¿ç”¨é¢„è®¾é…ç½®
devAuth := cert.ForDevelopment().Build()    // çº§åˆ«0 (é»˜è®¤)
prodAuth := cert.ForProduction().Build()    // çº§åˆ«1
testAuth := cert.ForTesting().Build()       // çº§åˆ«0

// æ–¹å¼2: æ˜¾å¼è®¾ç½®å®‰å…¨çº§åˆ«
auth := cert.NewAuthorizer().
    WithSecurityLevel(0).Build()            // ç¦ç”¨æ‰€æœ‰å®‰å…¨æ£€æŸ¥
auth := cert.NewAuthorizer().
    WithSecurityLevel(2).Build()            // é«˜çº§å®‰å…¨ä¿æŠ¤

// æ–¹å¼3: ä¾¿æ·é…ç½®æ–¹æ³•
auth := cert.NewAuthorizer().DisableSecurity().Build()      // çº§åˆ«0
auth := cert.NewAuthorizer().WithBasicSecurity().Build()    // çº§åˆ«1
auth := cert.NewAuthorizer().WithSecureDefaults().Build()   // çº§åˆ«2
auth := cert.NewAuthorizer().WithCriticalSecurity().Build() // çº§åˆ«3
```

### å„çº§åˆ«è¯¦ç»†åŠŸèƒ½

#### ğŸ”“ çº§åˆ«0ï¼šå®Œå…¨ç¦ç”¨ï¼ˆé»˜è®¤æ¨èï¼‰
```go
auth := cert.ForDevelopment().Build()
// æˆ–
auth := cert.NewAuthorizer().Build() // é»˜è®¤å°±æ˜¯çº§åˆ«0
```
- **æ£€æµ‹é¡¹**: æ— 
- **æ€§èƒ½**: æ— å½±å“
- **ç”¨é€”**: å¼€å‘ã€è°ƒè¯•ã€æµ‹è¯•
- **ç‰¹ç‚¹**: å®Œå…¨æ— å¹²æ‰°ï¼Œä¸“æ³¨äºä¸šåŠ¡é€»è¾‘å¼€å‘

#### ğŸ›¡ï¸ çº§åˆ«1ï¼šåŸºç¡€é˜²æŠ¤
```go
auth := cert.ForProduction().Build()
```
- **æ£€æµ‹é¡¹**: åŸºç¡€è°ƒè¯•å™¨æ£€æµ‹ï¼ˆIsDebuggerPresentã€TracerPidç­‰ï¼‰
- **æ€§èƒ½**: æå°å½±å“ï¼ˆ~1-2msï¼‰
- **ç”¨é€”**: ç”Ÿäº§ç¯å¢ƒåŸºç¡€ä¿æŠ¤
- **ç‰¹ç‚¹**: å…¼å®¹æ€§å¥½ï¼Œæ£€æµ‹å¸¸è§è°ƒè¯•å™¨

#### ğŸ›¡ï¸ çº§åˆ«2ï¼šé«˜çº§é˜²æŠ¤
```go
auth := cert.NewAuthorizer().WithSecureDefaults().Build()
```
- **æ£€æµ‹é¡¹**: 
  - é«˜çº§è°ƒè¯•å™¨æ£€æµ‹ï¼ˆæ—¶é—´æ”»å‡»ã€APIç›‘æ§ï¼‰
  - è™šæ‹Ÿæœºç¯å¢ƒæ£€æµ‹ï¼ˆVMwareã€VirtualBoxç­‰ï¼‰
  - æ²™ç®±ç¯å¢ƒæ£€æµ‹ï¼ˆCuckooã€Joe Sandboxç­‰ï¼‰
- **æ€§èƒ½**: å°å½±å“ï¼ˆ~5-10msï¼‰
- **ç”¨é€”**: é«˜ä»·å€¼è½¯ä»¶ä¿æŠ¤
- **ç‰¹ç‚¹**: å…¨é¢çš„åé€†å‘åˆ†æä¿æŠ¤

#### ğŸ”’ çº§åˆ«3ï¼šå…³é”®é˜²æŠ¤
```go
auth := cert.NewAuthorizer().WithCriticalSecurity().Build()
```
- **æ£€æµ‹é¡¹**: 
  - æ‰€æœ‰çº§åˆ«2çš„æ£€æµ‹é¡¹
  - è¿›ç¨‹ä¿æŠ¤ï¼ˆDLLæ³¨å…¥ã€ä»£ç æ³¨å…¥æ£€æµ‹ï¼‰
  - å†…å­˜ä¿æŠ¤ï¼ˆå…³é”®æ•°æ®åŠ å¯†ï¼‰
  - ç³»ç»Ÿè°ƒç”¨ç›‘æ§
- **æ€§èƒ½**: ä¸­ç­‰å½±å“ï¼ˆ~10-20msï¼‰
- **ç”¨é€”**: å…³é”®ç³»ç»Ÿã€å†›å·¥è½¯ä»¶
- **ç‰¹ç‚¹**: æœ€ä¸¥æ ¼çš„å®‰å…¨æ£€æŸ¥ï¼Œä¸å…è®¸ä»»ä½•åˆ†æ

### åè°ƒè¯•æŠ€æœ¯è¯¦è§£

#### ğŸ”“ çº§åˆ«0 - å®Œå…¨ç¦ç”¨ï¼ˆé»˜è®¤ï¼‰
```go
auth := cert.NewAuthorizer().Build() // é»˜è®¤çº§åˆ«0
// æˆ–æ˜¾å¼è®¾ç½®
auth := cert.NewAuthorizer().WithSecurityLevel(0).Build()
```
- **æ£€æµ‹é¡¹**: æ— ä»»ä½•æ£€æµ‹
- **æ€§èƒ½å¼€é”€**: 0ms
- **é€‚ç”¨åœºæ™¯**: å¼€å‘ã€è°ƒè¯•ã€å•å…ƒæµ‹è¯•
- **ç‰¹ç‚¹**: å®Œå…¨æ— å¹²æ‰°ï¼Œä¸“æ³¨ä¸šåŠ¡é€»è¾‘å¼€å‘

#### ğŸ›¡ï¸ çº§åˆ«1 - åŸºç¡€é˜²æŠ¤
```go
auth := cert.ForProduction().Build() // è‡ªåŠ¨è®¾ä¸ºçº§åˆ«1
// æˆ–æ‰‹åŠ¨è®¾ç½®
auth := cert.NewAuthorizer().WithBasicSecurity().Build()
```
**Windowså¹³å°æ£€æµ‹**ï¼š
- `IsDebuggerPresent()` - æ£€æµ‹è°ƒè¯•å™¨å­˜åœ¨
- PEBç»“æ„æ£€æŸ¥ - éªŒè¯`BeingDebugged`æ ‡å¿—
- è°ƒè¯•å †æ£€æµ‹ - æ£€æŸ¥å †æ ‡å¿—å¼‚å¸¸

**Linuxå¹³å°æ£€æµ‹**ï¼š
- TracerPidæ£€æŸ¥ - è¯»å–`/proc/self/status`ä¸­çš„è·Ÿè¸ªè¿›ç¨‹
- è°ƒè¯•å™¨è¿›ç¨‹æ‰«æ - æ£€æŸ¥`gdb`ã€`lldb`ç­‰è¿›ç¨‹

**macOSå¹³å°æ£€æµ‹**ï¼š
- P_TRACEDçŠ¶æ€ - é€šè¿‡`sysctl`æ£€æŸ¥è¿›ç¨‹è·Ÿè¸ªçŠ¶æ€
- è°ƒè¯•å™¨è¿›ç¨‹æ£€æµ‹ - æ‰«æå¸¸è§è°ƒè¯•å·¥å…·

**æ€§èƒ½å¼€é”€**: 1-2msï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒ

#### ğŸ›¡ï¸ çº§åˆ«2 - é«˜çº§é˜²æŠ¤  
```go
auth := cert.NewAuthorizer().WithSecureDefaults().Build()
```
**é«˜çº§åè°ƒè¯•æŠ€æœ¯**ï¼š
- **æ—¶é—´å·®æ”»å‡»æ£€æµ‹** - æµ‹é‡æŒ‡ä»¤æ‰§è¡Œæ—¶é—´ï¼Œæ£€æµ‹å•æ­¥è°ƒè¯•
- **è°ƒè¯•ç«¯å£æ£€æŸ¥** - é€šè¿‡`NtQueryInformationProcess`æ£€æŸ¥è°ƒè¯•ç«¯å£ï¼ˆWindowsï¼‰
- **å¼‚å¸¸å¤„ç†æ£€æµ‹** - åˆ©ç”¨å¼‚å¸¸å¤„ç†æœºåˆ¶æ£€æµ‹è°ƒè¯•å™¨
- **ç¡¬ä»¶æ–­ç‚¹æ£€æµ‹** - æ£€æŸ¥è°ƒè¯•å¯„å­˜å™¨`DR0-DR7`

**è™šæ‹Ÿæœºæ£€æµ‹**ï¼š
- **VMwareæ£€æµ‹** - æ£€æŸ¥VMwareç‰¹æœ‰è®¾å¤‡å’ŒæœåŠ¡
- **VirtualBoxæ£€æµ‹** - æŸ¥æ‰¾VBOXç›¸å…³æ³¨å†Œè¡¨é¡¹å’Œæ–‡ä»¶
- **Hyper-Væ£€æµ‹** - æ£€æµ‹Microsoftè™šæ‹ŸåŒ–æ ‡å¿—
- **QEMUæ£€æµ‹** - è¯†åˆ«QEMU/KVMç¯å¢ƒç‰¹å¾

**æ²™ç®±æ£€æµ‹**ï¼š
- **Cuckoo Sandbox** - æ£€æµ‹Cuckooç‰¹æœ‰çš„æ–‡ä»¶å’Œæ³¨å†Œè¡¨
- **Joe Sandbox** - è¯†åˆ«Joeåˆ†æç¯å¢ƒ
- **Anubisæ£€æµ‹** - æ£€æŸ¥Anubisæ¶æ„è½¯ä»¶åˆ†æå¹³å°

**æ€§èƒ½å¼€é”€**: 5-10msï¼Œé€‚åˆé«˜ä»·å€¼è½¯ä»¶ä¿æŠ¤

#### ğŸ”’ çº§åˆ«3 - å…³é”®é˜²æŠ¤
```go  
auth := cert.NewAuthorizer().WithCriticalSecurity().Build()
```
**è¿›ç¨‹ä¿æŠ¤æŠ€æœ¯**ï¼š
- **DLLæ³¨å…¥æ£€æµ‹** - ç›‘æ§å¼‚å¸¸çš„å†…å­˜æ˜ å°„å’Œæ¨¡å—åŠ è½½
- **ä»£ç æ³¨å…¥æ£€æµ‹** - æ£€æŸ¥å¯æ‰§è¡ŒåŒºåŸŸçš„å¼‚å¸¸å˜åŒ–  
- **å†…å­˜å¸ƒå±€åˆ†æ** - æ£€æµ‹å†…å­˜æ˜ å°„å¼‚å¸¸
- **API Hookæ£€æµ‹** - è¯†åˆ«APIæ‹¦æˆªå’Œé‡å®šå‘

**å†…å­˜ä¿æŠ¤æœºåˆ¶**ï¼š
- **å…³é”®æ•°æ®åŠ å¯†** - ä½¿ç”¨XORç­‰ç®—æ³•åŠ å¯†æ•æ„Ÿå†…å­˜åŒºåŸŸ
- **å†…å­˜æƒé™æ§åˆ¶** - åŠ¨æ€è®¾ç½®å…³é”®åŒºåŸŸè®¿é—®æƒé™
- **æ•°æ®å®Œæ•´æ€§æ ¡éªŒ** - å®šæœŸæ ¡éªŒå…³é”®æ•°æ®å®Œæ•´æ€§
- **å†…å­˜æ¸…ç†** - ç¨‹åºé€€å‡ºæ—¶å®‰å…¨æ¸…ç†æ•æ„Ÿæ•°æ®

**ç³»ç»Ÿç›‘æ§**ï¼š
- **ç³»ç»Ÿè°ƒç”¨ç›‘æ§** - æ£€æµ‹å¼‚å¸¸çš„ç³»ç»Ÿè°ƒç”¨æ¨¡å¼
- **æ–‡ä»¶ç³»ç»Ÿç›‘æ§** - ç›‘æ§æ•æ„Ÿæ–‡ä»¶è®¿é—®
- **ç½‘ç»œè¡Œä¸ºåˆ†æ** - æ£€æµ‹å¼‚å¸¸ç½‘ç»œé€šä¿¡

**æ€§èƒ½å¼€é”€**: 10-20msï¼Œé€‚åˆå…³é”®ç³»ç»Ÿå’Œå†›å·¥è½¯ä»¶

### æ£€æµ‹æŠ€æœ¯åˆ†ç±»è¯´æ˜

#### è°ƒè¯•å™¨æ£€æµ‹
| æŠ€æœ¯ | çº§åˆ« | å¹³å° | æè¿° |
|------|------|------|------|
| IsDebuggerPresent | 1+ | Windows | æœ€åŸºç¡€çš„è°ƒè¯•å™¨æ£€æµ‹API |
| PEBæ£€æŸ¥ | 1+ | Windows | æ£€æŸ¥è¿›ç¨‹ç¯å¢ƒå—ä¸­çš„è°ƒè¯•æ ‡å¿— |
| TracerPid | 1+ | Linux | æ£€æŸ¥è¿›ç¨‹è·Ÿè¸ªçŠ¶æ€ |
| P_TRACED | 1+ | macOS | æ£€æŸ¥è¿›ç¨‹è·Ÿè¸ªæ ‡å¿— |
| æ—¶é—´å·®æ”»å‡» | 2+ | å…¨å¹³å° | é€šè¿‡æ‰§è¡Œæ—¶é—´æ£€æµ‹å•æ­¥è°ƒè¯• |
| è°ƒè¯•ç«¯å£æ£€æŸ¥ | 2+ | Windows | é€šè¿‡NT APIæ£€æŸ¥è°ƒè¯•ç«¯å£ |
| å¼‚å¸¸å¤„ç†æ£€æµ‹ | 2+ | Windows | åˆ©ç”¨ç»“æ„åŒ–å¼‚å¸¸å¤„ç†æ£€æµ‹ |
| ç¡¬ä»¶æ–­ç‚¹æ£€æµ‹ | 2+ | x86/x64 | æ£€æŸ¥è°ƒè¯•å¯„å­˜å™¨çŠ¶æ€ |

#### ç¯å¢ƒæ£€æµ‹
| ç¯å¢ƒç±»å‹ | æ£€æµ‹çº§åˆ« | æ£€æµ‹æ–¹æ³• |
|----------|----------|----------|
| VMware | 2+ | æ³¨å†Œè¡¨é¡¹ã€è®¾å¤‡åç§°ã€MACåœ°å€å‰ç¼€ |
| VirtualBox | 2+ | æ³¨å†Œè¡¨é¡¹ã€æ–‡ä»¶ç³»ç»Ÿã€è®¾å¤‡æšä¸¾ |
| Hyper-V | 2+ | ç³»ç»Ÿä¿¡æ¯ã€ç‰¹æ®Šæ ‡å¿—ä½ |
| QEMU/KVM | 2+ | CPUIDæŒ‡ä»¤ã€è®¾å¤‡ä¿¡æ¯ |
| Cuckooæ²™ç®± | 2+ | ç‰¹æœ‰æ–‡ä»¶ã€æ³¨å†Œè¡¨ã€ç½‘ç»œé…ç½® |
| Joeæ²™ç®± | 2+ | ç¯å¢ƒå˜é‡ã€æ–‡ä»¶ç³»ç»Ÿç‰¹å¾ |

### ç¯å¢ƒæ£€æµ‹æŠ€æœ¯

#### è™šæ‹Ÿæœºæ£€æµ‹
- **VMware**: æ£€æµ‹VMwareç‰¹æœ‰è®¾å¤‡å’Œæ³¨å†Œè¡¨
- **VirtualBox**: æ£€æŸ¥VBOXç›¸å…³ç‰¹å¾
- **Hyper-V**: æ£€æµ‹Microsoftè™šæ‹ŸåŒ–æ ‡å¿—
- **QEMU**: æ£€æŸ¥QEMU/KVMç¯å¢ƒç‰¹å¾

#### æ²™ç®±æ£€æµ‹  
- **Cuckoo Sandbox**: æ£€æµ‹Cuckooç‰¹æœ‰çš„æ–‡ä»¶å’Œç¯å¢ƒ
- **Joe Sandbox**: æ£€æŸ¥Joeåˆ†æç¯å¢ƒç‰¹å¾
- **Anubis**: æ£€æµ‹Anubisæ¶æ„è½¯ä»¶åˆ†æç¯å¢ƒ

### è¿›ç¨‹ä¿æŠ¤æŠ€æœ¯

#### æ³¨å…¥æ£€æµ‹
- **DLLæ³¨å…¥**: ç›‘æ§å¼‚å¸¸çš„å†…å­˜æ˜ å°„å’Œæ¨¡å—åŠ è½½
- **ä»£ç æ³¨å…¥**: æ£€æŸ¥å¯æ‰§è¡ŒåŒºåŸŸçš„å¼‚å¸¸å˜åŒ–
- **å†…å­˜å¸ƒå±€**: åˆ†æå†…å­˜å¸ƒå±€å¼‚å¸¸

#### å†…å­˜ä¿æŠ¤
- **å…³é”®æ•°æ®åŠ å¯†**: ä½¿ç”¨XORåŠ å¯†ä¿æŠ¤æ•æ„Ÿå†…å­˜
- **å†…å­˜æƒé™**: è®¾ç½®å…³é”®åŒºåŸŸä¸ºåªè¯»
- **æ•°æ®æ¸…ç†**: ç¨‹åºé€€å‡ºæ—¶æ¸…ç†æ•æ„Ÿæ•°æ®

## ğŸ“‹ é…ç½®ç®¡ç†

### ç¯å¢ƒé¢„è®¾é…ç½®

```go
// å¼€å‘ç¯å¢ƒï¼ˆå®Œå…¨ç¦ç”¨å®‰å…¨æ£€æŸ¥ï¼‰
devAuth := cert.ForDevelopment() // SecurityLevel=0

// æµ‹è¯•ç¯å¢ƒï¼ˆç¦ç”¨å®‰å…¨æ£€æŸ¥ï¼‰
testAuth := cert.ForTesting()    // SecurityLevel=0

// ç”Ÿäº§ç¯å¢ƒï¼ˆåŸºç¡€å®‰å…¨æ£€æŸ¥ï¼‰  
prodAuth := cert.ForProduction() // SecurityLevel=1
```

### è‡ªå®šä¹‰å®‰å…¨é…ç½®

```go
// å®Œå…¨ç¦ç”¨å®‰å…¨æ£€æŸ¥ï¼ˆæ¨èç”¨äºå¼€å‘ï¼‰
auth := cert.NewAuthorizer().
    DisableSecurity().
    Build()

// é«˜çº§å®‰å…¨é…ç½®ï¼ˆé«˜ä»·å€¼è½¯ä»¶ï¼‰
auth := cert.NewAuthorizer().
    WithSecureDefaults().         // SecurityLevel=2
    WithMaxClockSkew(time.Minute).
    WithCacheTTL(time.Minute * 10).
    Build()

// å…³é”®å®‰å…¨é…ç½®ï¼ˆæœ€é«˜çº§åˆ«ï¼‰
auth := cert.NewAuthorizer().
    WithCriticalSecurity().       // SecurityLevel=3
    Build()

// æ˜¾å¼è®¾ç½®å®‰å…¨çº§åˆ«
auth := cert.NewAuthorizer().
    WithSecurityLevel(1).         // åŸºç¡€å®‰å…¨çº§åˆ«
    EnableTimeValidation(true).
    Build()
```

### é…ç½®æ–‡ä»¶æ”¯æŒ

```yaml
# config.yaml
version: "2.0.0"
enterprise_id: 62996
security:
  enable_anti_debug: true
  enable_time_validation: true
  require_hardware_binding: true
  max_clock_skew: "5m"
cache:
  ttl: "10m"
  max_size: 5000
  cleanup_interval: "30m"
```

## ğŸ”§ é«˜çº§åŠŸèƒ½

### æ‰¹é‡è¯ä¹¦å¤„ç†

```go
// åˆ›å»ºæ‰¹é‡ç®¡ç†å™¨
batchManager := cert.NewBatchManager(auth)

// æ·»åŠ æ‰¹é‡ç­¾å‘ä»»åŠ¡
requests := []*cert.ClientCertRequest{ /* ... */ }
results := batchManager.IssueBatch(requests)

// å¹¶å‘éªŒè¯å¤šä¸ªè¯ä¹¦
validationTasks := []cert.ValidationTask{ /* ... */ }
results := batchManager.ValidateBatch(validationTasks)
```

### ç¼“å­˜ä¼˜åŒ–

```go
// åˆ›å»ºç¼“å­˜æˆæƒç®¡ç†å™¨
cachedAuth := cert.NewCachedAuthorizer(auth, cert.CacheConfig{
    TTL:             10 * time.Minute,
    MaxSize:         1000,
    CleanupInterval: 5 * time.Minute,
})

// éªŒè¯ä¼šè‡ªåŠ¨ä½¿ç”¨ç¼“å­˜
err := cachedAuth.ValidateCert(certPEM, machineID)
```

### æ¨¡æ¿ç³»ç»Ÿ

```go
// ä½¿ç”¨é¢„å®šä¹‰æ¨¡æ¿
template := cert.GetTemplate("enterprise")
template.MaxValidDays = 730 // 2å¹´æœ‰æ•ˆæœŸ

// åˆ›å»ºè‡ªå®šä¹‰æ¨¡æ¿
customTemplate := &cert.CertificateTemplate{
    DefaultValidDays: 365,
    KeySize:         2048,
    Organization:    "My Company",
    // ...
}

cert.RegisterTemplate("custom", customTemplate)
```

## ğŸ“Š é”™è¯¯å¤„ç†

ç³»ç»Ÿæä¾›è¯¦ç»†çš„é”™è¯¯åˆ†ç±»å’Œå¤„ç†å»ºè®®ï¼š

```go
err := auth.ValidateCert(certPEM, machineID)
if err != nil {
    if certErr, ok := err.(*cert.CertError); ok {
        fmt.Printf("é”™è¯¯ç±»å‹: %s\n", certErr.GetCode())
        fmt.Printf("é”™è¯¯è¯¦æƒ…: %v\n", certErr.GetDetails())
        fmt.Printf("è§£å†³å»ºè®®: %v\n", certErr.GetSuggestions())
    }
}
```

### é”™è¯¯ç±»å‹

- `ValidationError`: è¯ä¹¦éªŒè¯é”™è¯¯ï¼ˆæ ¼å¼ã€è¿‡æœŸç­‰ï¼‰
- `SecurityError`: å®‰å…¨æ£€æŸ¥é”™è¯¯ï¼ˆè°ƒè¯•å™¨ã€æ²™ç®±ç­‰ï¼‰
- `ConfigError`: é…ç½®é”™è¯¯ï¼ˆCAç¼ºå¤±ã€å‚æ•°æ— æ•ˆç­‰ï¼‰
- `SystemError`: ç³»ç»Ÿé”™è¯¯ï¼ˆæ—¶é’Ÿåå·®ã€æ–‡ä»¶ç³»ç»Ÿç­‰ï¼‰

## ğŸ” ç›‘æ§å’Œæ—¥å¿—

### å®‰å…¨äº‹ä»¶ç›‘æ§

```go
// åˆå§‹åŒ–å®‰å…¨ç®¡ç†å™¨
sm := auth.InitSecurityManager()

// ç›‘æ§å®‰å…¨äº‹ä»¶ï¼ˆè‡ªåŠ¨è®°å½•ï¼‰
// [SECURITY] 2024-01-20 15:30:45: Virtual machine environment detected
// [SECURITY] 2024-01-20 15:30:46: Defense measures activated
```

### æ€§èƒ½ç›‘æ§

```go
// å¯ç”¨æ€§èƒ½ç»Ÿè®¡
auth.EnableMetrics(true)

// è·å–ç»Ÿè®¡ä¿¡æ¯
stats := auth.GetMetrics()
fmt.Printf("éªŒè¯æˆåŠŸç‡: %.2f%%\n", stats.SuccessRate)
fmt.Printf("å¹³å‡éªŒè¯æ—¶é—´: %v\n", stats.AvgValidationTime)
```

## ğŸ—ï¸ ç³»ç»Ÿé›†æˆ

### Web API é›†æˆ

```go
func validateLicenseHandler(w http.ResponseWriter, r *http.Request) {
    certData := r.Header.Get("X-License-Cert")
    machineID := r.Header.Get("X-Machine-ID")
    
    if err := auth.ValidateCert([]byte(certData), machineID); err != nil {
        http.Error(w, "License validation failed", 403)
        return
    }
    
    w.WriteHeader(200)
    json.NewEncoder(w).Encode(map[string]string{"status": "valid"})
}
```

### gRPC æœåŠ¡

```protobuf
service LicenseService {
    rpc ValidateLicense(ValidateRequest) returns (ValidateResponse);
    rpc IssueLicense(IssueRequest) returns (IssueResponse);
    rpc RevokeLicense(RevokeRequest) returns (RevokeResponse);
}
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### æœ€ä½³å®è·µ

1. **ä½¿ç”¨ç¼“å­˜**: å¯ç”¨è¯ä¹¦éªŒè¯ç¼“å­˜å‡å°‘é‡å¤è®¡ç®—
2. **æ‰¹é‡å¤„ç†**: å¤§è§„æ¨¡è¯ä¹¦æ“ä½œä½¿ç”¨æ‰¹é‡API
3. **å¼‚æ­¥æ›´æ–°**: åŠé”€åˆ—è¡¨å’Œé…ç½®ä½¿ç”¨å¼‚æ­¥æ›´æ–°
4. **è¿æ¥æ± **: ç½‘ç»œè¯·æ±‚ä½¿ç”¨è¿æ¥æ± å¤ç”¨
5. **å†…å­˜ç®¡ç†**: åŠæ—¶æ¸…ç†ä¸éœ€è¦çš„è¯ä¹¦æ•°æ®

### æ€§èƒ½æŒ‡æ ‡

- è¯ä¹¦éªŒè¯: ~1-5msï¼ˆç¼“å­˜å‘½ä¸­ï¼‰
- è¯ä¹¦ç­¾å‘: ~10-50ms
- å®‰å…¨æ£€æŸ¥: ~5-20ms
- æ‰¹é‡å¤„ç†: 1000ä¸ªè¯ä¹¦/ç§’

## ğŸ“‹ éƒ¨ç½²æŒ‡å—

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

```go
// ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®
auth := cert.ForProduction().
    WithCA(prodCACert, prodCAKey).      // ä½¿ç”¨ç”Ÿäº§CA
    WithCacheTTL(30 * time.Minute).     // é€‚ä¸­çš„ç¼“å­˜æ—¶é—´
    WithMaxClockSkew(1 * time.Minute).  // ä¸¥æ ¼çš„æ—¶é—´æ£€æŸ¥
    Build()
```

### é›†ç¾¤éƒ¨ç½²

```go
// æ”¯æŒå¤šå®ä¾‹éƒ¨ç½²
auth := cert.NewAuthorizer().
    WithSharedCache(redis.NewClient()). // ä½¿ç”¨Rediså…±äº«ç¼“å­˜
    WithDistributedLock().              // åˆ†å¸ƒå¼é”
    Build()
```

## âš ï¸ é‡è¦å®‰å…¨è¯´æ˜

### CA ç§é’¥ä¿æŠ¤

CA ç§é’¥æ˜¯æ•´ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒï¼Œå¿…é¡»ä¸¥æ ¼ä¿æŠ¤ï¼š

- **åŠ å¯†å­˜å‚¨**: ä½¿ç”¨ç¡¬ä»¶å®‰å…¨æ¨¡å—(HSM)æˆ–åŠ å¯†æ–‡ä»¶ç³»ç»Ÿ
- **è®¿é—®æ§åˆ¶**: é™åˆ¶è®¿é—®æƒé™ï¼Œä½¿ç”¨æœ€å°æƒé™åŸåˆ™  
- **å¤‡ä»½ç­–ç•¥**: å®‰å…¨çš„å¯†é’¥å¤‡ä»½å’Œæ¢å¤æœºåˆ¶
- **å®šæœŸè½®æ¢**: å®šæœŸæ›´æ¢CAå¯†é’¥ï¼ˆå»ºè®®2-5å¹´ï¼‰
- **å®¡è®¡æ—¥å¿—**: è®°å½•æ‰€æœ‰å¯†é’¥ä½¿ç”¨æ“ä½œ

### å®‰å…¨æœ€ä½³å®è·µ

1. **ç½‘ç»œå®‰å…¨**: ä½¿ç”¨HTTPSä¼ è¾“è¯ä¹¦å’ŒéªŒè¯è¯·æ±‚
2. **å­˜å‚¨å®‰å…¨**: åŠ å¯†å­˜å‚¨æ•æ„Ÿé…ç½®å’Œå¯†é’¥æ–‡ä»¶  
3. **è®¿é—®æ§åˆ¶**: å®æ–½ä¸¥æ ¼çš„èº«ä»½è®¤è¯å’Œæˆæƒ
4. **ç›‘æ§å‘Šè­¦**: éƒ¨ç½²å®‰å…¨äº‹ä»¶ç›‘æ§å’Œå¼‚å¸¸å‘Šè­¦
5. **åº”æ€¥å“åº”**: å»ºç«‹è¯ä¹¦æ³„éœ²åº”æ€¥å¤„ç†æµç¨‹

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### è¯ä¹¦éªŒè¯å¤±è´¥
```bash
# æ£€æŸ¥ç³»ç»Ÿæ—¶é—´
ntpdate -s time.nist.gov

# æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ
openssl x509 -in certificate.pem -noout -dates

# æ£€æŸ¥æœºå™¨ç åŒ¹é…
echo "å½“å‰æœºå™¨ç : $(go run -tags=cert ./cmd/get-machine-id)"
```

#### å®‰å…¨æ£€æŸ¥å¤±è´¥
```go
// ä¸´æ—¶ç¦ç”¨å®‰å…¨æ£€æŸ¥ï¼ˆä»…ç”¨äºè°ƒè¯•ï¼‰
devAuth := cert.ForDevelopment().Build() // EnableAntiDebug=false

// æˆ–æ£€æŸ¥å…·ä½“å®‰å…¨é—®é¢˜
if err := auth.PerformSecurityCheck(); err != nil {
    fmt.Printf("å®‰å…¨æ£€æŸ¥è¯¦æƒ…: %v\n", err)
}
```

## ğŸ“– API æ–‡æ¡£

å®Œæ•´çš„APIæ–‡æ¡£è¯·å‚é˜…ï¼š
- [GoDoc](https://pkg.go.dev/github.com/darkit/machineid/cert)
- [ç¤ºä¾‹ä»£ç ](./examples.go)
- [é…ç½®å‚è€ƒ](./config.go)

## ğŸ”„ ç‰ˆæœ¬å…¼å®¹æ€§

- **Goç‰ˆæœ¬**: éœ€è¦ Go 1.19+
- **å¹³å°æ”¯æŒ**: Windows, Linux, macOS
- **æ¶æ„æ”¯æŒ**: amd64, arm64, 386

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦æƒ…è¯·å‚é˜… [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»º Pull Request

### å¼€å‘ç¯å¢ƒè®¾ç½®

```bash
# å…‹éš†ä»£ç 
git clone https://github.com/darkit/machineid.git
cd machineid/cert

# è¿è¡Œæµ‹è¯•
go test -v ./...

# è¿è¡Œç¤ºä¾‹
go run examples.go
```

## ğŸ“ æ”¯æŒ

å¦‚æœæ‚¨é‡åˆ°é—®é¢˜æˆ–éœ€è¦å¸®åŠ©ï¼š

- ğŸ› [æŠ¥å‘ŠBug](https://github.com/darkit/machineid/issues/new?template=bug_report.md)
- ğŸ’¡ [åŠŸèƒ½å»ºè®®](https://github.com/darkit/machineid/issues/new?template=feature_request.md)  
- ğŸ“§ æŠ€æœ¯æ”¯æŒ: support@example.com
- ğŸ“š [Wikiæ–‡æ¡£](https://github.com/darkit/machineid/wiki)

---

**æ³¨æ„**: æœ¬è§£å†³æ–¹æ¡ˆä¸“ä¸ºåˆæ³•çš„è½¯ä»¶æˆæƒç®¡ç†è®¾è®¡ï¼Œè¯·éµå®ˆå½“åœ°æ³•å¾‹æ³•è§„ï¼Œä¸å¾—ç”¨äºæ¶æ„ç›®çš„ã€‚
